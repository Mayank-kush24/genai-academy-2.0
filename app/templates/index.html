{% extends "base.html" %}

{% block title %}Search - GenAI Academy 2.0{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-lg-8">
        <div class="text-center mb-4">
            <h1 class="display-4">
                <i class="bi bi-mortarboard-fill text-primary"></i>
            </h1>
            <h2>GenAI Academy 2.0</h2>
            <p class="text-muted">Records Management System</p>
        </div>
        
        <!-- Search Box -->
        <div class="card">
            <div class="card-body p-4">
                <form action="/search" method="get">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search"></i>
                        </span>
                        <input 
                            type="text" 
                            class="form-control border-start-0 ps-0" 
                            name="q"
                            placeholder="Search by name, email, or phone number..."
                            autofocus
                            required
                        >
                        <button class="btn btn-primary px-4" type="submit">
                            Search
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="row mt-5" id="stats">
            <div class="col-md-4 mb-3">
                <div class="card stat-card text-center">
                    <div class="card-body">
                        <i class="bi bi-people-fill text-primary" style="font-size: 2rem;"></i>
                        <h3 class="mt-2 mb-0" id="total-users">-</h3>
                        <p class="text-muted mb-0">Total Users</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stat-card text-center">
                    <div class="card-body">
                        <i class="bi bi-patch-check-fill text-success" style="font-size: 2rem;"></i>
                        <h3 class="mt-2 mb-0" id="verified-badges">-</h3>
                        <p class="text-muted mb-0">Verified Badges</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stat-card text-center">
                    <div class="card-body">
                        <i class="bi bi-clock-fill text-warning" style="font-size: 2rem;"></i>
                        <h3 class="mt-2 mb-0" id="pending-badges">-</h3>
                        <p class="text-muted mb-0">Pending Badges</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Links -->
        <div class="card mt-4">
            <div class="card-header">
                <i class="bi bi-link-45deg"></i> Quick Links
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <a href="/profiles" class="btn btn-outline-info w-100">
                            <i class="bi bi-person-circle"></i> View User Profiles
                        </a>
                    </div>
                    <div class="col-md-6 mb-2">
                        <a href="/view-data" class="btn btn-outline-info w-100">
                            <i class="bi bi-table"></i> View Data Tables
                        </a>
                    </div>
                    <div class="col-md-6 mb-2">
                        <a href="/import" class="btn btn-outline-success w-100">
                            <i class="bi bi-upload"></i> Import CSV Data
                        </a>
                    </div>
                    <div class="col-md-6 mb-2">
                        <a href="/verification-queue" class="btn btn-outline-primary w-100">
                            <i class="bi bi-clock-history"></i> View Verification Queue
                        </a>
                    </div>
                    <div class="col-md-6 mb-2">
                        <a href="/dashboard" class="btn btn-outline-primary w-100">
                            <i class="bi bi-graph-up-arrow"></i> View Dashboard
                        </a>
                    </div>
                    <div class="col-md-6 mb-2">
                        <a href="/badge-statistics" class="btn btn-outline-success w-100">
                            <i class="bi bi-award"></i> Badge Statistics
                        </a>
                    </div>
                    <div class="col-md-6 mb-2">
                        <a href="/export" class="btn btn-outline-primary w-100">
                            <i class="bi bi-download"></i> Export Data
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Load stats on page load
    fetch('/api/stats')
        .then(response => {
            // Check content type to ensure we got JSON
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                return response.text().then(text => {
                    console.error('Expected JSON but got:', contentType, text.substring(0, 200));
                    throw new Error('Response is not JSON');
                });
            }
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Stats data received:', data);
            
            // Check if data structure is correct
            if (data && data.users && data.badges) {
                const totalUsers = data.users.total || 0;
                const verifiedBadges = data.badges.verified || 0;
                const pendingBadges = data.badges.pending || 0;
                
                document.getElementById('total-users').textContent = totalUsers.toLocaleString();
                document.getElementById('verified-badges').textContent = verifiedBadges.toLocaleString();
                document.getElementById('pending-badges').textContent = pendingBadges.toLocaleString();
            } else {
                console.error('Invalid data structure:', data);
                // Set default values if structure is wrong
                document.getElementById('total-users').textContent = '0';
                document.getElementById('verified-badges').textContent = '0';
                document.getElementById('pending-badges').textContent = '0';
            }
        })
        .catch(error => {
            console.error('Error loading stats:', error);
            // Set default values on error
            document.getElementById('total-users').textContent = '0';
            document.getElementById('verified-badges').textContent = '0';
            document.getElementById('pending-badges').textContent = '0';
        });
</script>
{% endblock %}

